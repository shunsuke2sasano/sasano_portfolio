{% extends "base.html" %}
{% load static %}

{% block title %}アカウント作成{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>アカウント作成</h2>
    <form method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}

        <!-- アカウント種別選択 -->
        <div class="form-group">
            <label>
                <input type="radio" name="account_type" value="general" class="account-type" {% if form.account_type.value == "general" %}checked{% endif %}>
                一般
            </label>
            <label>
                <input type="radio" name="account_type" value="admin" class="account-type" {% if form.account_type.value == "admin" %}checked{% endif %}>
                管理者
            </label>
        </div>

        <!-- 共通の入力項目 -->
        <div class="form-group">
            {{ form.name.label_tag }}
            {{ form.name }}
            {% for error in form.name.errors %}
                <div class="text-danger validation-error">{{ error }}</div>
            {% endfor %}
        </div>

        <div class="form-group">
            {{ form.email.label_tag }}
            {{ form.email }}
            {% for error in form.email.errors %}
                <div class="text-danger validation-error">{{ error }}</div>
            {% endfor %}
        </div>

        <div class="form-group">
            {{ form.password.label_tag }}
            {{ form.password }}
            {% for error in form.password.errors %}
                <div class="text-danger validation-error">{{ error }}</div>
            {% endfor %}
        </div>

        <!-- 一般ユーザーの入力項目 -->
        <div class="general-fields">
            <div class="form-group">
                {{ form.profile_image.label_tag }}
                {{ form.profile_image }}
                {% for error in form.profile_image.errors %}
                    <div class="text-danger validation-error">{{ error }}</div>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ form.furigana.label_tag }}
                {{ form.furigana }}
                {% for error in form.furigana.errors %}
                    <div class="text-danger validation-error">{{ error }}</div>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ form.age.label_tag }}
                {{ form.age }}
                {% for error in form.age.errors %}
                    <div class="text-danger validation-error">{{ error }}</div>
                {% endfor %}
            </div>

            <div class="form-group">
                {{ form.bio.label_tag }}
                {{ form.bio }}
                {% for error in form.bio.errors %}
                    <div class="text-danger validation-error">{{ error }}</div>
                {% endfor %}
            </div>
        </div>

        <button type="submit" class="btn btn-primary">作成</button>
    </form>
</div>

<script src="{% static 'accounts/account_create.js' %}"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const generalFields = document.querySelector(".general-fields");
        const accountTypeRadios = document.querySelectorAll("input[name='account_type']");
        
        // バリデーションエラーを消去する関数
        function clearValidationErrors() {
            const errorMessages = document.querySelectorAll(".validation-error");
            errorMessages.forEach(error => {
                error.textContent = ""; // バリデーションエラーをクリア
            });
        }

        // 入力項目の表示/非表示を切り替える関数
        function toggleFields() {
            generalFields.style.display = accountTypeRadios[0].checked ? "block" : "none";
        }

        // ラジオボタンの変更時にバリデーションエラーを消去
        accountTypeRadios.forEach(radio => {
            radio.addEventListener("change", clearValidationErrors);
            radio.addEventListener("change", toggleFields);
        });

        toggleFields();  // 初期状態で適用
    });
</script>

{% endblock %}


